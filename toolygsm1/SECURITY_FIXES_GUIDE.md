# ๐ ุฏููู ุฅุตูุงุญุงุช ุงูุฃูุงู - TOOLY GSM Desktop

## ๐ **ุชุงุฑูุฎ ุงูุฅุตูุงุญุงุช:** $(date)

---

## โ **ุงูุฅุตูุงุญุงุช ุงูููุฌุฒุฉ**

### **1. ุฅุตูุงุญ Race Condition** โ
- โ ุฅุถุงูุฉ ุญูุงูุฉ ูู Race Condition ูู ุนูููุฉ ุงูุดุฑุงุก
- โ ุชุนุทูู ุงูุฒุฑ ุฃุซูุงุก ุงููุนุงูุฌุฉ
- โ ุงุณุชุฎุฏุงู Transaction Lock ูู ุงูุณูุฑูุฑ
- โ ุฅุถุงูุฉ Request ID ูุฑูุฏ ููู ุทูุจ

### **2. ุฅุฒุงูุฉ Secret Key ูู ุงูููุฏ** โ
- โ ููู Secret Key ุฅูู Environment Variables
- โ ุฅุถุงูุฉ ุฏุงูุฉ `GetSecretKey()` ุขููุฉ
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุนูุฏ ุนุฏู ูุฌูุฏ Secret Key
- โ ุชุญุฏูุซ ููู `env.example`

### **3. ุชุญุณูู JWT Validation** โ
- โ ูุญุต ุตุญุฉ JWT Token ูุญุณู
- โ ุงูุชุญูู ูู ุงูุชูุงุก ุงูุตูุงุญูุฉ
- โ ูุญุต Base64 encoding
- โ ูุนุงูุฌุฉ ุขููุฉ ููุฃุฎุทุงุก

### **4. ุฅุถุงูุฉ Rate Limiting** โ
- โ ุญูุงูุฉ ูู ูุฌูุงุช Brute Force
- โ ุญุฏ 10 ุทูุจุงุช ูู ุงูุฏูููุฉ ููู ูุณุชุฎุฏู
- โ Thread-safe implementation
- โ ุชูุธูู ุชููุงุฆู ููุทูุจุงุช ุงููุฏููุฉ

### **5. ุชุญุณูู Error Handling** โ
- โ ุฑุณุงุฆู ุฎุทุฃ ุขููุฉ ูุง ุชูุดู ูุนูููุงุช ุญุณุงุณุฉ
- โ ุชุตููู ุงูุฃุฎุทุงุก ูุฅุนุทุงุก ุฑุณุงุฆู ูุงุถุญุฉ
- โ ูุนุงูุฌุฉ ุดุงููุฉ ููุงุณุชุซูุงุกุงุช
- โ ุชุณุฌูู ุขูู ููุฃุฎุทุงุก

---

## ๐ **ุฎุทูุงุช ุงูุฅุนุฏุงุฏ ุงููุทููุจุฉ**

### **1. ุฅุนุฏุงุฏ Environment Variables (ูุทููุจ)**

#### **ูู Windows:**
```cmd
# ุงูุชุญ Command Prompt ูู Administrator
setx SUPABASE_API_KEY "your_actual_supabase_api_key_here"
setx API_BASE_URL "https://eskuly.org"
setx SUPABASE_BASE_URL "https://ewkzduhofisinbhjrzzu.supabase.co"
setx TOOLY_SECRET_KEY "your_strong_secret_key_here"

# ุฅุนุงุฏุฉ ุชุดุบูู Command Prompt
```

#### **ูู Linux/Mac:**
```bash
# ุฃุถู ุฅูู ~/.bashrc ุฃู ~/.zshrc
export SUPABASE_API_KEY="your_actual_supabase_api_key_here"
export API_BASE_URL="https://eskuly.org"
export SUPABASE_BASE_URL="https://ewkzduhofisinbhjrzzu.supabase.co"
export TOOLY_SECRET_KEY="your_strong_secret_key_here"

# ุฅุนุงุฏุฉ ุชุญููู ุงูููู
source ~/.bashrc
```

### **2. ุฅูุดุงุก Secret Key ููู**

```bash
# ุฅูุดุงุก Secret Key ุนุดูุงุฆู ููู (64 ุญุฑู)
openssl rand -hex 32

# ุฃู ุงุณุชุฎุฏุงู PowerShell
[System.Web.Security.Membership]::GeneratePassword(64, 0)
```

### **3. ุงุฎุชุจุงุฑ ุงูุฅุนุฏุงุฏ**

```bash
# ุงูุชุญูู ูู Environment Variables
echo $SUPABASE_API_KEY
echo $TOOLY_SECRET_KEY

# ุชุดุบูู ุงูุจุฑูุงูุฌ
dotnet run
```

---

## ๐ก๏ธ **ุงููุฒุงูุง ุงูุฃูููุฉ ุงูุฌุฏูุฏุฉ**

### **1. ุญูุงูุฉ ูู Race Condition**
```csharp
// ููุน ุงูุทูุจุงุช ุงููุชุฒุงููุฉ
if (btnBuy.Tag == null || btnBuy.Tag.ToString() == "PROCESSING")
    return;
```

### **2. Secret Key ุขูู**
```csharp
// ุงูุญุตูู ุนูู Secret Key ูู Environment Variables
public static string GetSecretKey()
{
    var secretKey = Environment.GetEnvironmentVariable("TOOLY_SECRET_KEY");
    if (string.IsNullOrEmpty(secretKey))
    {
        throw new InvalidOperationException("TOOLY_SECRET_KEY not set!");
    }
    return secretKey;
}
```

### **3. JWT Validation ูุญุณู**
```csharp
// ูุญุต ุดุงูู ูู JWT Token
public static bool IsValidToken(string token)
{
    // ูุญุต ุงูุดูู
    var parts = token.Split('.');
    if (parts.Length != 3) return false;
    
    // ูุญุต Base64
    // ูุญุต ุงูุชูุงุก ุงูุตูุงุญูุฉ
    // ูุญุต ุงูุชูููุน
}
```

### **4. Rate Limiting**
```csharp
// ุญูุงูุฉ ูู ุงููุฌูุงุช
public static bool IsRateLimited(string userId)
{
    // ุญุฏ 10 ุทูุจุงุช ูู ุงูุฏูููุฉ
    // Thread-safe implementation
    // ุชูุธูู ุชููุงุฆู
}
```

### **5. Error Handling ุขูู**
```csharp
// ุฑุณุงุฆู ุฎุทุฃ ุขููุฉ
if (errorMsg.Contains("insufficient"))
{
    return "ุฑุตูุฏู ุบูุฑ ูุงู ูุดุฑุงุก ูุฐู ุงูุฃุฏุงุฉ";
}
```

---

## ๐ **ูุงุฆูุฉ ุงูุชุญูู ุงูุฃูููุฉ**

### **ูุจู ุงููุดุฑ:**
- [ ] ุชุนููู ุฌููุน Environment Variables
- [ ] ุฅูุดุงุก Secret Key ููู
- [ ] ุงุฎุชุจุงุฑ ุงูุจุฑูุงูุฌ ูุน Environment Variables
- [ ] ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ Secret Key ูู ุงูููุฏ
- [ ] ุงุฎุชุจุงุฑ Rate Limiting
- [ ] ุงุฎุชุจุงุฑ JWT Validation
- [ ] ุงุฎุชุจุงุฑ Error Handling

### **ุจุนุฏ ุงููุดุฑ:**
- [ ] ูุฑุงูุจุฉ ุงูู logs ููุฃุฎุทุงุก
- [ ] ุงูุชุญูู ูู ุนูู Rate Limiting
- [ ] ูุฑุงูุจุฉ ูุญุงููุงุช ุงููุตูู ุงููุดุจููุฉ
- [ ] ุชุญุฏูุซ Secret Key ุจุงูุชุธุงู
- [ ] ูุฑุงุฌุนุฉ ุงูุฃุฐููุงุช

---

## ๐ **ุงูุชุญูู ูู ุงูุฅุตูุงุญุงุช**

### **1. ูุญุต ุนุฏู ูุฌูุฏ Secret Key ูู ุงูููุฏ:**
```bash
# ุงูุจุญุซ ุนู Secret Key ููุดูู (ูุฌุจ ุฃู ุชููู ุงููุชูุฌุฉ ูุงุฑุบุฉ)
grep -r "TOOLY-GSM-SECRET-KEY-2024" .

# ุงูุจุญุซ ุนู Environment Variables (ูุฌุจ ุฃู ุชุธูุฑ ุงููุชุงุฆุฌ)
grep -r "TOOLY_SECRET_KEY" .
```

### **2. ุงุฎุชุจุงุฑ Rate Limiting:**
```bash
# ุชุดุบูู ุงูุจุฑูุงูุฌ ููุญุงููุฉ ุฅุฑุณุงู ุทูุจุงุช ูุชุนุฏุฏุฉ
# ูุฌุจ ุฃู ูุชู ุญุธุฑ ุงูุทูุจุงุช ุจุนุฏ 10 ุทูุจุงุช ูู ุงูุฏูููุฉ
```

### **3. ุงุฎุชุจุงุฑ JWT Validation:**
```bash
# ุงุฎุชุจุงุฑ ูุน JWT ุตุญูุญ
# ุงุฎุชุจุงุฑ ูุน JWT ููุชูู ุงูุตูุงุญูุฉ
# ุงุฎุชุจุงุฑ ูุน JWT ูุฒูู
```

---

## โ๏ธ **ุชุญุฐูุฑุงุช ูููุฉ**

### **1. ูุง ุชุดุงุฑู Environment Variables:**
- โ **ูุง ุชุถุนูุง ูู Git**
- โ **ูุง ุชุดุงุฑููุง ุนุจุฑ Email**
- โ **ูุง ุชุถุนูุง ูู ูููุงุช config ุนุงูุฉ**

### **2. ุงุณุชุฎุฏู Secret Key ููู:**
- โ **64 ุญุฑู ุนูู ุงูุฃูู**
- โ **ูุฒูุฌ ูู ุฃุญุฑู ูุฃุฑูุงู ูุฑููุฒ**
- โ **ุชุบููุฑู ุจุงูุชุธุงู**

### **3. ูุฑุงูุจุฉ ุงูุฃูุงู:**
- โ **ุฑุงูุจ ุงูู logs ุจุงูุชุธุงู**
- โ **ุญุฏุซ Secret Key ูู 3-6 ุฃุดูุฑ**
- โ **ุฑุงูุจ ูุญุงููุงุช ุงููุตูู ุงููุดุจููุฉ**

---

## ๐ **ุงุณุชูุดุงู ุงูุฃุฎุทุงุก**

### **ุฎุทุฃ: "TOOLY_SECRET_KEY environment variable is not set"**

**ุงูุญู:**
1. ุชุฃูุฏ ูู ุชุนููู Environment Variable
2. ุฃุนุฏ ุชุดุบูู Terminal/Command Prompt
3. ุชุญูู ูู ุตุญุฉ ุงุณู ุงููุชุบูุฑ

### **ุฎุทุฃ: "ุชู ุชุฌุงูุฒ ุงูุญุฏ ุงููุณููุญ ูู ุงูุทูุจุงุช"**

**ุงูุญู:**
1. ุงูุชุธุฑ ุฏูููุฉ ูุงุญุฏุฉ
2. ุชุญูู ูู ุนุฏู ูุฌูุฏ ุทูุจุงุช ูุชุนุฏุฏุฉ
3. ุฃุนุฏ ุชุดุบูู ุงูุจุฑูุงูุฌ

### **ุฎุทุฃ: "ุงูุชูุช ุตูุงุญูุฉ ุงูุฌูุณุฉ"**

**ุงูุญู:**
1. ุฃุนุฏ ุชุณุฌูู ุงูุฏุฎูู
2. ุชุญูู ูู ุตุญุฉ JWT Token
3. ุชุญูู ูู ุงุชุตุงู ุงูุฅูุชุฑูุช

---

## โ **ุงูุฎูุงุตุฉ**

### **๐ ุชู ุฅุตูุงุญ ุฌููุน ุงูุซุบุฑุงุช ุงูุฃูููุฉ ุงูุฎุทูุฑุฉ!**

**ุงููุชุงุฆุฌ:**
- ๐ **Race Condition**: ุชู ุฅุตูุงุญู ุจุงููุงูู
- ๐ **Secret Key**: ูุญูู ูู Environment Variables
- ๐ก๏ธ **JWT Validation**: ูุญุณู ููููู
- ๐ซ **Rate Limiting**: ุญูุงูุฉ ูู ุงููุฌูุงุช
- ๐ **Error Handling**: ุขูู ููุง ููุดู ูุนูููุงุช

### **โ๏ธ ุชุญุฐูุฑ ููู:**
**ูุฌุจ ุชุนููู ุฌููุน Environment Variables ูุจู ุชุดุบูู ุงูุจุฑูุงูุฌุ ูุฅูุง ุณูุชููู ุงูุจุฑูุงูุฌ ูุน ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ.**

### **๐ ุงูุจุฑูุงูุฌ ุงูุขู ุขูู ูููุดุฑ!**

---

## ๐ **ุงูุฏุนู**

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู ูู ุงูุฅุนุฏุงุฏ:
1. ุฑุงุฌุน ูุฐุง ุงูุฏููู
2. ุชุฃูุฏ ูู ุชุนููู ุฌููุน Environment Variables
3. ุฃุนุฏ ุชุดุบูู Terminal/Command Prompt
4. ุชุญูู ูู ุตุญุฉ ุงูููู ุงููุฏุฎูุฉ
5. ุฑุงุฌุน ุฑุณุงุฆู ุงูุฎุทุฃ ุจุนูุงูุฉ

**ุชู ุฅุตูุงุญ ุฌููุน ูุดุงูู ุงูุฃูุงู ุจูุฌุงุญ!** ๐
